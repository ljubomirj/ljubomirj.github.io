javascript:(async()=>{const HANDLE='@ljupc0',SCROLL_PAUSE_MS=1200,SCROLL_MAX=80;const STOP_ID=(prompt('Enter STOP tweet ID (already archived):')||'').trim();if(STOP_ID&&!/^\d+$/.test(STOP_ID)){alert('Invalid STOP ID. Use digits only.');return}const sleep=ms=>new Promise(r=>setTimeout(r,ms));const formatTime=iso=>{const dt=new Date(iso);const time=dt.toLocaleString('en-US',{hour:'numeric',minute:'2-digit',hour12:true});const date=dt.toLocaleDateString('en-US', {month:'short',day:'numeric',year:'numeric'});return${time} Â· ${date}};const isRepost=article=>{const sc=article.querySelector('[data-testid="socialContext"]');return sc&&/reposted/i.test(sc.innerText)};const parseTweet=article=>{const timeEl=article.querySelector('a[href*="/status/"] time');if(!timeEl)return null;const a=timeEl.closest('a[href*="/status/"]');const url=a?.href||'';const idMatch=url.match(/status/(\d+)/);if(!idMatch)return null;const id=idMatch[1];if(isRepost(article))return{id,isRepost:true};let displayName='',handle='';const nameNode=article.querySelector('div[data-testid="User-Name"]');if(nameNode) {const spans=Array.from(nameNode.querySelectorAll('span')).map(s=>(s.textContent||'').trim()).filter(Boolean);handle=spans.find(s=>s.startsWith('@'))|| HANDLE;displayName=spans.find(s=>!s.startsWith('@'))||''}else{handle=HANDLE;displayName=''}const textBlocks=Array.from(article.querySelectorAll('div[data-testid="tweetText"]'));const text=textBlocks.length?textBlocks.map(n=>n.innerText).join('\n'):'';const iso=timeEl.getAttribute('datetime')||'';const timeLine=iso?formatTime(iso):'';return{id,url,displayName,handle,text,timeLine,isRepost:false}};const getAllTweetArticles=()=>Array.from(document.querySelectorAll('article'));const extractNewerThanStop=seenIds=>{const articles=getAllTweetArticles();const items=[];for(const art of articles){const t=parseTweet(art);if(!t||!t.id||seenIds.has(t.id))continue;seenIds.add(t.id);items.push(t)}return items};const formatBlock=item=>{const lines=[];lines.push(  * ${item.url});lines.push('');if(item.displayName)lines.push(item.displayName);lines.push(item.handle|| HANDLE);lines.push('');lines.push(item.text||'');lines.push(item.timeLine||'');return lines.join('\n')};const collectedById=new Map();const seenInDom=new Set();let foundStop=false;for(let i=0;i<SCROLL_MAX&&!foundStop;i++){const newlyParsed=extractNewerThanStop(seenInDom);if(STOP_ID&&document.querySelector(a[href*="/ status/${STOP_ID}"])){foundStop=true}for(const t of newlyParsed){if(t.isRepost)continue;if(t.url&&t.url.includes('/status/')) {collectedById.set(t.id,t)}}if(foundStop)break;window.scrollTo({top:document.body.scrollHeight,behavior:'smooth'});await sleep(SCROLL_PAUSE_MS)}const anchors=Array.from(document.querySelectorAll('a[href*="/status/"]')).map(a=>a.href).filter(h=>//status/\d+/.test(h));const idsInDomOrder=anchors.map(h=>(h.match(/ status/(\d+)/)||[])[1]).filter(Boolean);const outIds=[];for(const id of idsInDomOrder){if(STOP_ID&&id===STOP_ID)break;if(collectedById.has(id))outIds.push(id)} const orderedUnique=[],added=new Set();for(const id of outIds){if(!added.has(id)){added.add(id);orderedUnique.push(id)}}const block=orderedUnique.map(id=>formatBlock(collectedById.get(id))).join('\n\n');if(!block.trim()){alert('No new posts found above STOP.');return}try{await navigator.clipboard.writeText(block)}catch(e){}const blob=new Blob([block],{type:'text/plain;charset=utf-8'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='twitter-LJ-posts-archive-block.txt';document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(url);const ta=document.createElement('textarea');ta.value=block;Object.assign(ta.style, {position:'fixed',top:'5%',left:'5%',width:'90%',height:'80%',zIndex:999999,background:'#fff',color:'#000',padding:'10px',border:'2px solid #333',fontFamily:'monospace',fontSize:'12px'});document.body.appendChild(ta);ta.addEventListener('keydown',e=>{if(e.key==='Escape')ta.remove()});ta.focus();ta.select();alert('New posts copied/downloaded. You can also copy from the big textarea (Esc to close).');})();
